<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LAPCo Bingo</title>
  <link rel="stylesheet" href="./styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <!-- Waiver modal -->
  <div id="consentModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;align-items:center;justify-content:center">
    <div style="background:#111;border:1px solid #333;border-radius:12px;max-width:520px;width:90%;padding:18px">
      <h3 style="margin:0 0 8px">Media Waiver</h3>
      <p style="margin:0 0 12px;line-height:1.35">
        By participating in contests and games, I consent to LAPCo using my submitted photos, videos, display name,
        and progress for promotional purposes (website, social media, in-studio). Participation is voluntary—join only if you agree.
      </p>
      <button id="consentAgree" style="padding:10px 14px;border-radius:10px;border:none;background:#6d4bff;color:#fff;font-weight:800;cursor:pointer">I Agree</button>
    </div>
  </div>

  <header class="top">
    <div class="title">LAPCo Bingo</div>
    <div class="actions">
      <div id="who">Not signed in</div>

      <!-- Email login (magic link) -->
      <input id="emailInput" type="email" placeholder="you@example.com" class="env" />
      <button id="emailLogin">Email me a login link</button>

      <!-- Google login -->
      <button id="signin">Sign in with Google</button>
      <button id="signout" class="ghost">Sign out</button>
    </div>
  </header>

  <main>
    <section class="status">
      <div id="stats"></div>
    </section>

    <!-- Artwork container with fixed aspect ratio -->
    <div class="bg-wrap">
      <!-- Art is a background on this div (no <img>) -->
      <div class="art" role="img" aria-label="Monthly Bingo artwork"></div>
      <!-- Grid overlays inside the same box -->
      <div id="board" class="board"></div>
    </div>

    <div id="claimbar" style="max-width:900px;margin:10px auto 0;text-align:center"></div>

    <section class="prizes">
      <h3>Prizes</h3>
      <ul>
        <li><strong>Bingo:</strong> Free limited-edition 2025 KSU shirt (ordered when you win)</li>
        <li><strong>Blackout:</strong> Entry to $100 Visa gift-card drawing</li>
      </ul>
    </section>

    <!-- Instructions -->
    <section class="card">
      <h3 style="margin-top:0">How to Play</h3>
      <ol style="line-height:1.5;margin:0;padding-left:18px">
        <li>Sign in and complete squares that match your activities.</li>
        <li>Tap a square to stamp it when you’ve done it.</li>
        <li>When you get <strong>BINGO</strong> (any 5-in-a-row), click the yellow “Email studio &amp; log Bingo” button.</li>
        <li>Keep going for <strong>BLACKOUT</strong> (all 25) and click the green button to log it.</li>
      </ol>
      <p style="margin:10px 0 0; opacity:.9">
        Questions? Email <a href="mailto:powercatpilates@gmail.com">powercatpilates@gmail.com</a>.
      </p>
    </section>

    <!-- Leaderboard -->
    <section class="card">
      <h3 style="margin-top:0">Leaderboard (Top 10)</h3>
      <div id="leaderboard"><div style="opacity:.7">Loading…</div></div>
    </section>

    <!-- ADMIN PANEL (shows only if profiles.is_admin = true) -->
    <section id="adminPanel" style="display:none;" class="card">
      <h3 style="margin-top:0">Admin: Manage Contest</h3>
      <div style="display:grid; gap:12px">
        <label>Contest ID
          <input id="contestId" class="env" placeholder="October2025">
        </label>
        <label>Contest Name
          <input id="contestName" class="env" placeholder="K-State October Bingo">
        </label>

        <label>Tiles (enter exactly 25 lines)</label>
        <textarea id="tilesText" rows="10" class="textarea"></textarea>

        <div style="display:flex; gap:12px; flex-wrap:wrap">
          <div>
            <label>Background image (PNG/JPG)</label><br>
            <input type="file" id="bgFile" accept="image/*">
          </div>
          <div>
            <label>Stamp image (PNG)</label><br>
            <input type="file" id="stampFile" accept="image/*">
          </div>
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <button id="saveTiles">Save tiles</button>
          <button id="uploadBg" class="ghost">Upload background</button>
          <button id="uploadStamp" class="ghost">Upload stamp</button>
          <button id="setActive" class="ghost">Set active contest</button>
        </div>

        <div id="adminMsg" style="opacity:.9"></div>
      </div>
    </section>

    <!-- Display name modal -->
    <div id="nameModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;align-items:center;justify-content:center">
      <div style="background:#111;border:1px solid #333;border-radius:12px;max-width:420px;width:92%;padding:18px">
        <h3 style="margin:0 0 8px">Pick a display name</h3>
        <p style="margin:0 0 12px;opacity:.85">This shows on the leaderboard instead of your email.</p>
        <input id="nameInput" placeholder="e.g., Sam M." style="width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#0e0e0e;color:#eee;margin-bottom:12px">
        <button id="nameSave" style="padding:10px 14px;border-radius:10px;border:none;background:#6d4bff;color:#fff;font-weight:800;cursor:pointer">Save</button>
      </div>
    </div>

    <section class="footer">
      <details>
        <summary>Debug</summary>
        <pre id="debug">(none)</pre>
      </details>
    </section>
  </main>

  <script src="./app.js"></script>
</body>
</html>
